---
layout: post
title: SCCM vNext updates and servicing feature!
date: 2015-09-24 13:55:07.000000000 +02:00
type: post
published: true
status: publish
categories:
- ConfigMgr
tags: []
meta:
  _wpas_done_all: '1'
  _oembed_67a79e5852ca652d3770e216d9e4e12b: "{{unknown}}"
  _oembed_2391607ae1d71ab340d5d86a2e58d1a7: "{{unknown}}"
author:
  login: kimoppalfens
  email: kim.oppalfens@oscc.be
  display_name: The WMI guy
  first_name: The
  last_name: WMI guy
---
<p><span style="color:#555555; font-family:Arial">Hi All,<br />
</span></p>
<h1>Feature Explained<br />
</h1>
<p>On the 23<sup>rd</sup> of September 2015 the ConfigMgr Product team released a <a href="http://blogs.technet.com/b/mniehaus/archive/2012/09/02/speed-up-mdt-task-sequences-in-configuration-manager.aspxhttp:/blogs.technet.com/b/configmgrteam/archive/2015/09/23/now-available-update-for-system-center-config-manager-tp3.aspx">blog</a> on an update for Configuration Manager Technical Preview 3, or the new and upcoming version of SCCM, known by many as SCCM vNext. The blogpost contained roughly 321 words. (Yes I did put that in there to weasel you into going in and counting the words <span style="font-family:Wingdings">J</span>)</p>
<p>The shortness of the blog, and it's number of words, in my opinion, doesn't do justice to the importance of this new feature called CM Updates, Updates and servicing or Easy setup, depending on who you talk to. This feature is the way forward for the product team to update the next release of Configuration Manager, and might well replace Service packs and/or CU's in the future. One of the challenges for the CM product team has always been to find the right "release vehicle". Release vehicles are a means to get updates out to the install base, and at present are usually one of these:</p>
<ul>
<li>New release
</li>
<li>Service pack
</li>
<li>Cumulative Update
</li>
<li>Web release/download
</li>
</ul>
<p>The first 2 in that list, are at least perceived as disruptive to the systems management service, while Cumulative Updates have quite different perceptions across different IT departments and companies. But there's definitely a set of IT departments that consider the CU's, and their installation disruptive as well. That means all sorts of things come into play when any of these are released, release management, a rollback plan, the change advisory board to name a few. The ambition of CM updates is to alleviate that pain through an integrated servicing mechanism much like other software that auto-updates, yet with admin approval.</p>
<p>Or in the words of the blog: <em>"<span style="color:#424242; font-family:Segoe UI; font-size:9pt">This update is the first to be delivered through our new "Updates and Servicing" node in the product. Moving forward, this is how you should expect to receive Technical Preview updates. When System Center Configuration Manager becomes generally available in Q4 of this calendar year, we will continue to use this same channel to provide a faster, lighter and easier update experience for new features, bug fixes, and more."</span></em>
	</p>
<p>People already involved with Microsoft Intune in a Hybrid scenario will see a lot of similarities with what is called the weave feature to download mobile device management extensions and enable/install these extensions. This should not come as a surprise, as one of the driving factors behind weave was the speed with which new versions and features of IOS, Android and Windows Phone were released. The mobile device management market is rapidly growing and evolving, and needed it's own release vehicle, that release vehicle became 'Extensions for Microsoft Intune' a.k.a weave. Now, with Windows 10 entering the Windows as a service-era, with things like the current branch potentially upgrading every 10 months, Microsoft needed something similar to update general CM items, and not just mobile device management related items. The blog released yesterday was the announcement of "the very first real world public test of this mechanism!". The announcement itself lacked a bit of enthusiasm, but this is a feature that I am excited about for the future of CM.</p>
<p>This feature can update and deliver fixes and features for:</p>
<ul>
<li>Site servers
</li>
<li>SMS_Provider
</li>
<li>Configuration Manager console
</li>
<li>Configuration manager clients
</li>
</ul>
<p>Which should provide the necessary flexibility to update just about anything, as this allows the product team to update, the ConfigMgr File system, the Admin UI file system, the database (Data as well as new tables, views, Stored procedres,…, as WMI)</p>
<h1>Feature documentation<br />
</h1>
<p>The announcement itself didn't go into much detail explaining how the future worked, however did contain a <a href="http://blogs.technet.com/b/mniehaus/archive/2012/09/02/speed-up-mdt-task-sequences-in-configuration-manager.aspxhttps:/technet.microsoft.com/library/dn965439.aspx">link</a> to the documentation of the Microsoft System Center Configuration Manager Technical Preview. This page contains a section on "Updates and servicing" which gives some insight into how this all operates.</p>
<p>Some important items in that documentation, are highlighted below, but I do encourage you to go and read the doc itself to get all the nitty gritty details</p>
<p>First of all, this entire process is driven by a new site system role called the cloud connection point, which replaces the Microsoft Intune connector site system role. In the current tech preview (Release 3), <span style="color:red">the cloud connection point needs to be installed on the primary site server and needs internet access. </span>Both of these limitations are expected to be resolved in a subsequent release, and an offline procedure is planned for a future release, as mentioned in the comments section of the blog.</p>
<p>Other limitations: Os language must be English, and you must set your date/time format to this absolutely weird way of throwing days, months and years in some random order called MM-DD-YYYY. Not sure who ever came up with that way of noting dates, but apparently that's what we need to use. In testing and hearing experiences from others, <span style="color:red"><strong>this is the number one deal-breaker: The update process itself seems to be rock-solid, assuming you set your Date/time format accordingly.<br />
</strong></span></p>
<p>New updates are checked for every 7 days, since the install date of the environment. According to the docs a restart of the SMS_executive service triggers the check for updates as well. I'd venture a guess that restarting the SMS_DMP_Downloader might trick it as well, which would be less disruptive. (To be tested).</p>
<p>Once the updates are downloaded you'll find them in <strong>Administration</strong> &gt; <strong>Cloud Services</strong> &gt; <strong>Updates and Services</strong> as available, you can subsequently click <strong>Install Update Pack<br />
</strong></p>
<p>As a final note, just running the prerequisite checker  standalone, from this same node, doesn't work in the current build. Triggering this will perform the install as well.</p>
<h1>Feature at work – The server upgrade<br />
</h1>
<ol>
<li>Step 1 would be to restart your sms_executive service if the update hasn't arrive in your <strong>Updates and Services</strong> node.
</li>
<li>The update should arrive and be in the downloading state for a while. You can monitor the download progress in the DMPDownloader.log the log should contains lines similar to:
</li>
</ol>
<p><em>EasySetupDownload thread is starting...  $$&lt;SMS_DMP_DOWNLOADER&gt;&lt;09-22-2015 21:21:36.981-120&gt;&lt;thread=4700 (0x125C)&gt;<br />
</em></p>
<p style="margin-left: 18pt"><em>Download Easy setup payloads~~  $$&lt;SMS_DMP_DOWNLOADER&gt;&lt;09-22-2015 21:21:37.008-120&gt;&lt;thread=4700 (0x125C)&gt;<br />
</em></p>
<p style="margin-left: 18pt"><em>Get manifest.cab url~~  $$&lt;SMS_DMP_DOWNLOADER&gt;&lt;09-22-2015 21:21:37.012-120&gt;&lt;thread=4700 (0x125C)&gt;<br />
</em></p>
<p style="margin-left: 18pt"><em>Successfully write the update meta into outbox for package dcd17922-2c96-4bd7-b72d-e9159582cdf2~~  $$&lt;SMS_DMP_DOWNLOADER&gt;&lt;09-22-2015 21:40:36.934-120&gt;&lt;thread=4700 (0x125C)&gt;<br />
</em></p>
<ol>
<li>This particular update is somewhere between 800 and 900 Mbytes, so depending on your internet connection speed, it might take a while to download everything. In my particular experience, mumbling "patience is a virtue" over and over again had neither a positive nor negative impact on the download speed.
</li>
<li>Once downloaded you should see the update in your <strong>&lt;CM Install Folder&gt;\EasySetupPayLoad</strong>
		</li>
<li>
<div><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup1.png" alt="" /><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup2.png" alt="" />
			</div>
<p>
 </p>
</li>
<li>If the update arrive your UI should look like the 2 screenshots below, and have the update state listed as Available.
</li>
<li><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup3.png" alt="" /><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup4.png" alt="" />
		</li>
<li>Once the update's state switches to the available state, you can launch the "<strong>Install Update Pack"</strong> action from the Quick access toolbar, which provides you with the details of the CM Update and the ability to ignore prereq check warnings. (Feel free to leave this unchecked in the current build as warnings are ignored no matter what you select).
</li>
<li><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup5.png" alt="" />
		</li>
<li>Next, you need to read the License agreement, and accept them. Yes, the idea is that you read them first.
</li>
<li><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup6.png" alt="" />
		</li>
<li>Subsequently you can chose to upgrade all your clients at once, or perform testing to a pre-production collection you specify. This ties into the client updating feature that was enhanced in CM2012SP1CU1 to also support cumulative update releases as opposed to the original behavior which only supported service packs.
</li>
<li><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup7.png" alt="" />
		</li>
<li>The rest of the wizard doesn't provide you with any options to configure, find screenshots below for completeness.
</li>
<li><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup8.png" alt="" />
		</li>
<li><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup9.png" alt="" />
		</li>
<li><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup10.png" alt="" />
		</li>
<li>At this point the Administration node will list the Update in a state "installing". Depending on your environment this installation might take a while to complete.
</li>
<li>Logfiles involved during this upgrade are dmpdownloader.log, sitecomp.log and cmupdate.log and obviously the logs for prereq checking and setup which in my case are looked in the root of the c:\ drive.
</li>
<li><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup11.png" alt="" />
		</li>
<li>In the file system you'll also notice the downloaded files are being copied to a brand new folder in your site server installation called CMUStaging
</li>
<li>Upon successful installation the <strong><em>Monitoring\Overview\Site Servicing status</em></strong> should contain a status of installed
</li>
<li>And the about screen should contain a version of 1509, please note that the Console versions and Site version remain at 5.0.8299.1000
</li>
<li><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup12.png" alt="" />
		</li>
<li>
<div><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup13.png" alt="" />
			</div>
<p>
 </p>
</li>
</ol>
<h1>Feature at work – The admin ui upgrade<br />
</h1>
<p>Once the server is upgraded, the next time the admin ui is opened you'll be prompted by a message asking you to upgrade your admin UI to the newest version. Much like the request to enable new extensions for Intune when they have arrived. This is a similar system and poses the same challenges, you'll have to be an administrator and have the ability to install the upgrade for this to work successfully.</p>
<ol>
<li><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup14.png" alt="" /><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup15.png" alt="" />
		</li>
<li><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup16.png" alt="" />
		</li>
<li>Again this is a fairly regular install, so you can monitor progress by following the ConfigMgrAdminUISetup and its verbose variant.
</li>
</ol>
<p>
 </p>
<p style="margin-left: 18pt"><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup17.png" alt="" />
	</p>
<p style="margin-left: 18pt">
 </p>
<h1>Personal observations – Notes from the <span style="text-decoration:line-through">field</span> Lab<br />
</h1>
<p>The process appears to be fairly solid in several tests I've ran, as long as you make sure you have the DateTime format set to MM-DD-YYYY, I know, it's an American thing, get over it. They'll come to their senses one day and adopt Metric, 220Volt and a sensible datetime format, and might even come up with a proper name for that sport where you're seldomly allowed to use your foot. (Don't hold your breath, for now).</p>
<h3>Troubleshooting<br />
</h3>
<p>If you managed to break the upgrade anyway, have a look at the troubleshooting section in the link provide in the documentation section. But it roughly comes down to</p>
<ol>
<li>Make sure you set the datetime format correctly
</li>
<li>Are you 100% positive you verified item 1
</li>
<li>Really?
</li>
<li>
<div>If you goofed up on 1-3 run the following command in SQL Management studio, after typing a full page in Word with the sentence "I am a goof!"
</div>
<p><em>EXEC spCMUSetUpdatePackageState N'dcd17922-2c96-4bd7-b72d-e9159582cdf2', 262146, N''<br />
</em></p>
</li>
</ol>
<h3>Wmi<br />
</h3>
<p>5 new WMI classes have surfaced that seem to be related to this feature:</p>
<ul>
<li>SMS_CM_UpdateFeatures (0 Instances, 1 method (UpdateFeatureExposureStatus)
</li>
<li>SMS_CM_UpdatePackageFeatures (0 Instances, 1 method (UpdateFeatureExposureStatus)
</li>
<li>SMS_CM_Update_Packages (1 instance with guid of update, 2 methods (IsCurrentWorkingUpdatePackage, updatePrereqAndStateFlags)
</li>
<li>SMS_CM_UpdatePackageSiteStatus (1 instance with guid of update, no methods)
</li>
<li>SMS_CM_UpdatePackDetailedSiteStatus (multiple instances with different steps ranging from prereq checking to actual install steps. (State 3, appears to be success (to be validated)
</li>
</ul>
<h3>SQL<br />
</h3>
<p>5 new views where created related to the 5 WMI classes above:</p>
<ul>
<li>Vsms_CM_updatefeatures
</li>
<li>vSMS_CM_UpdatePackageFeatures
</li>
<li>vSMS_CM_UpdatePackages
</li>
<li>vSMS_CM_UpdatePackageSiteStatus
</li>
<li>vSMS_CM_LatestInstalledPackageFeatures
</li>
</ul>
<p>10 Stored procedures have surfaced that appear to be related to this new servicing feature</p>
<p><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup18.png" alt="" />
	</p>
<p>20 new tables have surfaced that appear to be related to this new servicing feature</p>
<p><img src="{{ site.baseurl }}/assets/092415_1353_SCCMvNextup19.png" alt="" />
	</p>
<p>
 </p>
<p><span style="color:#555555; font-family:Arial; font-size:9pt">Enjoy.<br />"The M in WMI stands for Magic"<br />""Everyone is an expert at something" Kim Oppalfens - ConfigMgr Expert for lack of any other expertise<br />System Center Configuration Manager MVP<br />http://www.scug.be/blogs/sccm/default.aspx</p>
<p>http://www.linkedin.com/in/kimoppalfens</p>
<p>http://twitter.com/thewmiguy</span></p>
